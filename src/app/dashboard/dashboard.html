<div class="p-4">
  <div class="header">
    <h2 class="text-2xl">Dashboard</h2>
    <button matButton="tonal" [mat-menu-trigger-for]="widgetMenu">Add widget</button>
  </div>

  <mat-menu #widgetMenu="matMenu">
    @for(w of store.widgetsToAdd(); track w.id) {
    <button mat-menu-item (click)="store.addWidget(w)">
      {{ w.title }}
    </button>
    } @empty {
    <button mat-menu-item>No widgets to add</button>
    }
  </mat-menu>

  <div #dashboard class="dashboard-widgets" pDroppable="widgets" (onDrop)="onDrop($event)"
       [style.--grid-cols]="store.columns()">
    @for(w of store.addedWidgets(); track w.id) {
    <app-dashboard-widget 
      [data]="w"
      (onDragStart)="onDragStart($event)"
      (onDragEnd)="onDragEnd($event)"
    />
    }
    <!-- Dummy widget for full-width drop target -->
    @if (isDragging()) {
    <div 
      class="dummy-widget" 
      [attr.data-widget-id]="'dummy'"
      pDroppable="widgets"
      (onDrop)="onDropFullWidth($event)"
    >
      <div class="dummy-content">
        Drop here for full width
      </div>
    </div>
    }
  </div>
</div>
